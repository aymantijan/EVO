{% extends 'base.html' %}

{% block title %}Leaderboard - Classement Global{% endblock %}

{% block content %}
<div class="leaderboard-container">
    <!-- HEADER -->
    <div class="leaderboard-header">
        <div class="header-content">
            <h1>Classement Global</h1>
            <p>D√©couvrez les meilleurs joueurs et l√©gendes de la communaut√©</p>
        </div>
    </div>

    <!-- TABS -->
    <div class="leaderboard-tabs">
        <button class="tab-btn active" data-tab="global">
            <span class="tab-text">Global</span>
        </button>
        <button class="tab-btn" data-tab="legends">
            <span class="tab-text">Universel</span>
        </button>
    </div>

    <!-- SEARCH & FILTER -->
    <div class="leaderboard-controls">
        <div class="search-box">
            <input type="text" id="search-input" placeholder="Chercher un joueur...">
            <span class="search-icon">R</span>
        </div>
        
        <!-- BOUTONS DE TRI -->
        <div class="sort-buttons">
            <button class="sort-btn active" data-sort="xp">
                <span class="sort-icon">‚ö°</span>
                <span class="sort-text">Classement XP</span>
            </button>
            <button class="sort-btn" data-sort="hp">
                <span class="sort-icon">‚ù§Ô∏è</span>
                <span class="sort-text">Classement HP</span>
            </button>
        </div>
    </div>

    <!-- YOUR RANK -->
    <div class="your-rank-card" id="your-rank-card">
        <div class="your-rank-content">
            <div class="your-rank-left">
                <div class="your-rank-badge">#<span id="your-rank-position">-</span></div>
                <div class="your-rank-info">
                    <div class="your-rank-label">Votre Classement</div>
                    <div class="your-rank-username" id="your-rank-username">Non connect√©</div>
                </div>
            </div>
            <div class="your-rank-middle">
                <div class="your-rank-stat">
                    <span class="stat-label">Niveau</span>
                    <span class="stat-value" id="your-rank-level">1</span>
                </div>
                <div class="your-rank-stat">
                    <span class="stat-label">Galaxie</span>
                    <span class="stat-value" id="your-rank-galaxy">√âtoile du Matin</span>
                </div>
                <div class="your-rank-stat">
                    <span class="stat-label">XP</span>
                    <span class="stat-value" id="your-rank-xp">0</span>
                </div>
                <div class="your-rank-stat">
                    <span class="stat-label">HP</span>
                    <span class="stat-value" id="your-rank-hp">0</span>
                </div>
            </div>
            <div class="your-rank-right">
                <div class="progress-label">Progression</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="your-rank-progress"></div>
                </div>
                <div class="progress-percent" id="your-rank-percentage">0%</div>
            </div>
        </div>
    </div>

    <!-- STATS -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-card-icon">P</div>
            <div class="stat-card-content">
                <div class="stat-card-label">Total</div>
                <div class="stat-card-value" id="total-players">0</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-card-icon">X</div>
            <div class="stat-card-content">
                <div class="stat-card-label">XP Moyen</div>
                <div class="stat-card-value" id="avg-xp">0</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-card-icon">‚ù§Ô∏è</div>
            <div class="stat-card-content">
                <div class="stat-card-label">HP Moyen</div>
                <div class="stat-card-value" id="avg-hp">0</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-card-icon">L</div>
            <div class="stat-card-content">
                <div class="stat-card-label">Niveau Moyen</div>
                <div class="stat-card-value" id="avg-level">Lvl 1</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-card-icon">G</div>
            <div class="stat-card-content">
                <div class="stat-card-label">Galaxie Moyenne</div>
                <div class="stat-card-value" id="avg-galaxy">√âtoile du Matin</div>
            </div>
        </div>
    </div>

    <!-- LEADERBOARD TABLE -->
    <div class="leaderboard-table-section">
        <h2 class="section-title" id="table-title">Classement par XP</h2>
        <div class="leaderboard-table-wrapper">
            <table class="leaderboard-table">
                <thead>
                    <tr>
                        <th class="rank-col">Rang</th>
                        <th class="player-col">Joueur</th>
                        <th class="level-col">Niveau</th>
                        <th class="galaxy-col">Galaxie</th>
                        <th class="xp-col"><span id="primary-stat-header">XP</span></th>
                        <th class="hp-col"><span id="secondary-stat-header">HP</span></th>
                        <th class="action-col">Action</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-tbody">
                    <!-- Dynamique -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- PAGINATION -->
    <div class="pagination">
        <button class="btn-pagination" id="prev-page">Precedent</button>
        <span class="pagination-info">Page <span id="current-page">1</span> / <span id="total-pages">1</span></span>
        <button class="btn-pagination" id="next-page">Suivant</button>
    </div>
</div>

<!-- PROFILE MODAL -->
<div id="profile-modal-overlay" class="modal-overlay">
    <div class="modal-container">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-section">
                    <h2 id="modal-username" class="modal-username">Joueur</h2>
                    <span id="modal-legend-badge" class="modal-legend-badge"></span>
                </div>
                <button class="modal-close" onclick="closeProfileModal()">X</button>
            </div>

            <div class="modal-body">
                <div class="modal-stats-section">
                    <div class="modal-stat-box">
                        <span class="modal-stat-label">Niveau</span>
                        <span class="modal-stat-value" id="modal-level">1</span>
                    </div>
                    <div class="modal-stat-box">
                        <span class="modal-stat-label">Galaxie</span>
                        <span class="modal-stat-value" id="modal-galaxy">√âtoile du Matin</span>
                    </div>
                    <div class="modal-stat-box">
                        <span class="modal-stat-label">XP Total</span>
                        <span class="modal-stat-value" id="modal-xp">0</span>
                    </div>
                </div>

                <div class="modal-divider"></div>

                <div class="modal-description-section">
                    <h3 class="modal-description-title">A propos</h3>
                    <p id="modal-description" class="modal-description-text">Aucune description disponible</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* ==================== LAYOUT ====================*/
.leaderboard-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.leaderboard-header {
    text-align: center;
    margin-bottom: 40px;
    padding: 40px 20px;
    background: rgba(33, 128, 141, 1);
    border-radius: 12px;
    color: white;
}

.leaderboard-header h1 {
    font-size: 2.5rem;
    font-weight: bold;
    margin-bottom: 10px;
    color: white;
}

.leaderboard-header p {
    font-size: 1.1rem;
    opacity: 0.9;
}

/* ==================== TABS ====================*/
.leaderboard-tabs {
    display: flex;
    gap: 15px;
    margin-bottom: 30px;
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 15px;
    flex-wrap: wrap;
}

.tab-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: none;
    border: none;
    border-bottom: 3px solid transparent;
    color: var(--text-secondary);
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
}

.tab-btn:hover {
    color: var(--color-primary);
}

.tab-btn.active {
    color: var(--color-primary);
    border-bottom-color: var(--color-primary);
}

/* ==================== CONTROLS ====================*/
.leaderboard-controls {
    display: flex;
    margin-bottom: 30px;
    gap: 15px;
    flex-wrap: wrap;
}

.search-box {
    position: relative;
    flex: 1;
    max-width: 400px;
}

.search-box input {
    width: 100%;
    padding: 12px 15px 12px 40px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    font-size: 1rem;
    background: var(--color-surface);
    color: var(--text-primary);
    transition: border-color 0.3s ease;
}

.search-box input:focus {
    outline: none;
    border-color: var(--color-primary);
}

.search-icon {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.1rem;
    opacity: 0.6;
    font-weight: bold;
}

/* ==================== BOUTONS DE TRI ==================== */
.sort-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.sort-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: none;
    border: none;
    border-bottom: 3px solid transparent;
    color: var(--text-secondary);
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
}

.sort-btn:hover {
    color: var(--color-primary);
}

.sort-btn.active {
    color: var(--color-primary);
    border-bottom-color: var(--color-primary);
}

.sort-icon {
    font-size: 1.2rem;
}

.sort-text {
    font-weight: 600;
}

/* ==================== YOUR RANK ====================*/
.your-rank-card {
    background: var(--color-surface);
    border: 2px solid var(--border-color);
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 40px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.your-rank-content {
    display: flex;
    align-items: center;
    gap: 30px;
}

.your-rank-left {
    display: flex;
    align-items: center;
    gap: 15px;
    min-width: 150px;
}

.your-rank-badge {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
    color: white;
    border-radius: 50%;
    font-size: 1.5rem;
    font-weight: bold;
}

.your-rank-info {
    display: flex;
    flex-direction: column;
}

.your-rank-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
}

.your-rank-username {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--text-primary);
}

.your-rank-middle {
    display: flex;
    gap: 40px;
    flex: 1;
}

.your-rank-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
}

.stat-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
}

.stat-value {
    font-size: 1.3rem;
    font-weight: bold;
    color: var(--color-primary);
}

.your-rank-right {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    min-width: 150px;
}

.progress-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    font-weight: 600;
}

.progress-bar {
    width: 150px;
    height: 8px;
    background: var(--border-color);
    border-radius: 10px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
    width: 0%;
    transition: width 0.5s ease;
}

.progress-percent {
    font-size: 0.9rem;
    font-weight: bold;
    color: var(--color-primary);
}

/* ==================== STATS GRID ====================*/
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 50px;
}

.stat-card {
    background: var(--color-surface);
    border: 2px solid var(--border-color);
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: all 0.3s ease;
}

.stat-card:hover {
    border-color: var(--color-primary);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.stat-card-icon {
    font-size: 2rem;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-primary);
    color: white;
    border-radius: 50%;
    font-weight: bold;
}

.stat-card-content {
    flex: 1;
}

.stat-card-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
    margin-bottom: 5px;
}

.stat-card-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--color-primary);
}

/* ==================== TABLE ====================*/
.leaderboard-table-section {
    margin-bottom: 40px;
}

.section-title {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 25px;
    color: var(--text-primary);
}

.leaderboard-table-wrapper {
    overflow-x: auto;
    border: 2px solid var(--border-color);
    border-radius: 12px;
}

.leaderboard-table {
    width: 100%;
    border-collapse: collapse;
    background: var(--color-surface);
}

.leaderboard-table thead {
    background: var(--color-primary);
    color: white;
}

.leaderboard-table th {
    padding: 15px;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 0.5px;
}

.leaderboard-table td {
    padding: 15px;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-primary);
}

.leaderboard-table tbody tr {
    transition: all 0.3s ease;
}

.leaderboard-table tbody tr:hover {
    background: rgba(0, 0, 0, 0.02);
}

.leaderboard-table tbody tr.your-row {
    background: rgba(0, 0, 0, 0.05);
    border-left: 4px solid var(--color-primary);
}

.leaderboard-table tbody tr.legend-row {
    background: rgba(255, 193, 7, 0.05);
    border-left: 4px solid #FFD700;
}

.rank-col {
    width: 80px;
}

.rank-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
    color: white;
    border-radius: 50%;
    font-weight: bold;
    font-size: 0.95rem;
}

.rank-number.legend {
    background: linear-gradient(135deg, #FFD700, #FFA500);
    color: #333;
}

.player-col {
    flex: 1;
    min-width: 200px;
}

.player-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.player-avatar-mini {
    width: 40px;
    height: 40px;
    background: var(--color-primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    flex-shrink: 0;
    border: 2px solid var(--color-primary);
    overflow: hidden;
}

.player-avatar-mini img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
}

.player-avatar-mini.legend {
    border: 2px solid #FFD700;
}

.player-details {
    display: flex;
    flex-direction: column;
    gap: 3px;
}

.player-username {
    font-weight: 600;
    color: var(--text-primary);
}

.player-badge {
    display: inline-block;
    width: fit-content;
    padding: 2px 8px;
    background: var(--color-primary);
    color: white;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: bold;
    text-transform: uppercase;
}

.player-badge.legend {
    background: #FFD700;
    color: #333;
}

.player-badge.moroccan {
    background: #FF0000;
    color: white;
}

.level-col {
    width: 100px;
}

.level-badge {
    display: inline-block;
    padding: 6px 12px;
    background: rgba(0, 0, 0, 0.05);
    color: var(--color-primary);
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.9rem;
}

.galaxy-col {
    width: 200px;
}

.galaxy-badge {
    display: inline-block;
    padding: 6px 12px;
    background: rgba(0, 0, 0, 0.05);
    color: var(--color-secondary);
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.9rem;
}

.xp-col, .hp-col {
    width: 120px;
    text-align: right;
}

.xp-value {
    font-weight: 600;
    color: var(--color-primary);
    font-size: 1.1rem;
}

.hp-value {
    font-weight: 600;
    color: #E74C3C;
    font-size: 1.1rem;
}

.action-col {
    width: 100px;
    text-align: center;
}

.btn-view-profile {
    padding: 8px 16px;
    background: var(--color-primary);
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.btn-view-profile:hover {
    background: var(--color-secondary);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.btn-view-profile.legend {
    background: #FFD700;
    color: #333;
}

.btn-view-profile.legend:hover {
    background: #FFA500;
}

/* ==================== PAGINATION ====================*/
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    padding: 20px 0;
}

.btn-pagination {
    padding: 10px 20px;
    background: var(--color-primary);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-pagination:hover:not(:disabled) {
    background: var(--color-secondary);
    transform: translateY(-2px);
}

.btn-pagination:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.pagination-info {
    color: var(--text-secondary);
    font-weight: 600;
}

/* ==================== MODAL ====================*/
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    backdrop-filter: blur(4px);
}

.modal-overlay.active {
    display: flex;
}

.modal-container {
    width: 100%;
    display: flex;
    justify-content: center;
    padding: 20px;
}

.modal-content {
    background: var(--color-surface);
    border-radius: 16px;
    max-width: 600px;
    width: 100%;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    overflow: hidden;
}

@keyframes slideUp {
    from {
        transform: translateY(40px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 30px;
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
    color: white;
    border-bottom: none;
}

.modal-title-section {
    display: flex;
    align-items: center;
    gap: 15px;
}

.modal-username {
    font-size: 1.8rem;
    font-weight: bold;
    margin: 0;
    color: white;
}

.modal-legend-badge {
    display: inline-block;
    padding: 6px 12px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid white;
    color: white;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.modal-close {
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid white;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 5px 12px;
    border-radius: 6px;
    transition: all 0.3s ease;
    font-weight: bold;
}

.modal-close:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: rotate(90deg);
}

.modal-body {
    padding: 30px;
}

.modal-stats-section {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.modal-stat-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    padding: 20px;
    background: var(--color-primary);
    border-radius: 12px;
    color: white;
    text-align: center;
}

.modal-stat-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 700;
    opacity: 0.9;
}

.modal-stat-value {
    font-size: 1.6rem;
    font-weight: bold;
}

.modal-divider {
    height: 2px;
    background: var(--border-color);
    margin: 20px 0;
}

.modal-description-section {
    background: rgba(0, 0, 0, 0.03);
    padding: 20px;
    border-radius: 12px;
}

.modal-description-title {
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 700;
    color: var(--text-secondary);
    margin: 0 0 12px 0;
}

.modal-description-text {
    font-size: 1rem;
    line-height: 1.6;
    color: var(--text-primary);
    margin: 0;
    word-wrap: break-word;
}

/* ==================== RESPONSIVE ====================*/
@media (max-width: 768px) {
    .leaderboard-header {
        padding: 30px 15px;
    }

    .leaderboard-header h1 {
        font-size: 1.8rem;
    }

    .your-rank-content {
        flex-direction: column;
        gap: 20px;
    }

    .your-rank-middle {
        width: 100%;
        justify-content: space-around;
    }

    .stats-grid {
        grid-template-columns: 1fr;
    }

    .leaderboard-table {
        font-size: 0.9rem;
    }

    .leaderboard-table th,
    .leaderboard-table td {
        padding: 10px;
    }

    .rank-col,
    .level-col,
    .xp-col,
    .hp-col,
    .action-col {
        width: auto;
    }
    
    .sort-buttons {
        width: 100%;
        justify-content: center;
    }
    
    .sort-btn {
        flex: 1;
        min-width: 120px;
    }

    .modal-stats-section {
        grid-template-columns: 1fr;
    }

    .modal-content {
        margin: 20px;
    }

    .modal-header {
        padding: 20px;
    }

    .modal-body {
        padding: 20px;
    }
}
</style>


<script>
    // ==================== CSRF TOKEN ====================

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    const csrftoken = getCookie('csrftoken');

    // ==================== CONFIGURATION ====================

    const ROWS_PER_PAGE = 20;
    const TOTAL_LEVELS = 1000;

    let currentPage = 1;
    let allPlayers = [];
    let allLegends = [];
    let filteredPlayers = [];
    let currentUser = null;
    let currentTab = 'global';
    let currentSortBy = 'xp'; // Tri par d√©faut

    // ==================== FONCTIONS DE TRI ====================
    function changeSortType(sortType) {
        console.log('üîÑ Changement de tri:', sortType);
        currentSortBy = sortType;
        
        // Mettre √† jour les boutons actifs
        document.querySelectorAll('.sort-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.sort === sortType) {
                btn.classList.add('active');
            }
        });
        
        // Mettre √† jour le titre du tableau
        const tableTitle = document.getElementById('table-title');
        const primaryHeader = document.getElementById('primary-stat-header');
        const secondaryHeader = document.getElementById('secondary-stat-header');
        
        if (sortType === 'hp') {
            if (tableTitle) tableTitle.textContent = 'Classement par HP';
            if (primaryHeader) primaryHeader.textContent = 'HP';
            if (secondaryHeader) secondaryHeader.textContent = 'XP';
        } else {
            if (tableTitle) tableTitle.textContent = 'Classement par XP';
            if (primaryHeader) primaryHeader.textContent = 'XP';
            if (secondaryHeader) secondaryHeader.textContent = 'HP';
        }
        
        // Appliquer le tri
        applyCurrentSort();
        currentPage = 1;
        renderLeaderboard();
        renderStats();
    }
    
    function applyCurrentSort() {
        if (currentSortBy === 'hp') {
            // Trier par HP (descendant)
            filteredPlayers.sort((a, b) => (b.hp || 0) - (a.hp || 0));
        } else {
            // Trier par XP (descendant)
            filteredPlayers.sort((a, b) => b.total_xp - a.total_xp);
        }
    }

    // ==================== GALAXIES ====================
    const GALAXIES = {
        1: { name: '√âtoile du Matin', color: '#10b981', min: 1, max: 100 },
        2: { name: 'Androm√®de', color: '#06b6d4', min: 101, max: 200 },
        3: { name: 'Voie Lact√©e', color: '#f59e0b', min: 201, max: 300 },
        4: { name: 'Sombrero', color: '#ec4899', min: 301, max: 400 },
        5: { name: 'Spirale du Cygne', color: '#8b5cf6', min: 401, max: 500 },
        6: { name: 'N√©buleuse du Crabe', color: '#ef4444', min: 501, max: 600 },
        7: { name: 'Galaxie d\'Orion', color: '#3b82f6', min: 601, max: 700 },
        8: { name: 'Tr√©sor Cosmique', color: '#14b8a6', min: 701, max: 800 },
        9: { name: 'Paradis Stellaire', color: '#f97316', min: 801, max: 900 },
        10: { name: 'Univers Supr√™me', color: '#6366f1', min: 901, max: 1000 },
    };

    function getGalaxyByLevel(level) {
        for (let i = 1; i <= 10; i++) {
            const g = GALAXIES[i];
            if (level >= g.min && level <= g.max) return g;
        }
        return GALAXIES[1];
    }

    // ==================== XP FORMULAS ====================
    function getXpForLevel(level) {
        return Math.floor((level * (level + 1) / 2) * 100);
    }

    function getTotalXpForLevel(level) {
        let total = 0;
        for (let i = 1; i <= level; i++) {
            total += getXpForLevel(i);
        }
        return total;
    }

    function calculateLevelFromXp(totalXp) {
        let level = 1;
        while (level < TOTAL_LEVELS) {
            if (getTotalXpForLevel(level + 1) > totalXp) {
                break;
            }
            level++;
        }
        return Math.min(level, TOTAL_LEVELS);
    }

    function getProgressToNextLevel(level, totalXp) {
        const totalXpForCurrent = getTotalXpForLevel(level);
        const totalXpForNext = getTotalXpForLevel(level + 1);
        if (totalXpForNext === totalXpForCurrent) return 100;
        const progress = ((totalXp - totalXpForCurrent) / (totalXpForNext - totalXpForCurrent)) * 100;
        return Math.min(100, Math.max(0, progress));
    }

// ==================== LEGENDS DATA (VERSION √âTENDUE) ====================
const LEGENDS_BY_DOMAIN = {
    'science': [
        { name: 'Albert Einstein', xp: getTotalXpForLevel(900), description: 'Th√©orie de la relativit√© - Fondateur de la physique moderne', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/3e/Einstein_1921_by_F_Schmutzer.jpg' },
        { name: 'Marie Curie', xp: getTotalXpForLevel(895), description: '2x Prix Nobel - D√©couvertes chimiques r√©volutionnaires', avatar: 'https://upload.wikimedia.org/wikipedia/commons/7/7e/Marie_Curie_c._1920s.jpg' },
        { name: 'Isaac Newton', xp: getTotalXpForLevel(890), description: 'Lois de la physique classique - Fondateur du calcul diff√©rentiel', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/39/GodfreyKneller-IsaacNewton-1689.jpg' },
        { name: 'Stephen Hawking', xp: getTotalXpForLevel(885), description: 'Trous noirs et cosmologie - Vulgarisation scientifique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/eb/Stephen_Hawking.StarChild.jpg' },
        { name: 'Nikola Tesla', xp: getTotalXpForLevel(880), description: 'Courant alternatif - Pionnier de l\'√©lectricit√© moderne', avatar: 'https://upload.wikimedia.org/wikipedia/commons/7/79/Tesla_circa_1890.jpeg' },
        { name: 'Charles Darwin', xp: getTotalXpForLevel(875), description: 'Th√©orie de l\'√©volution - R√©volution biologique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/33/Charles_Darwin_by_Julia_Margaret_Cameron_2.jpg' },
        { name: 'Galil√©e', xp: getTotalXpForLevel(870), description: 'P√®re de l\'astronomie moderne - R√©volution scientifique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/d/d4/Justus_Sustermans_-_Portrait_of_Galileo_Galilei%2C_1636.jpg' },
        { name: 'Ada Lovelace', xp: getTotalXpForLevel(865), description: 'Premi√®re programmeuse - Pionni√®re de l\'informatique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/a4/Ada_Lovelace_portrait.jpg' },
        { name: 'Louis Pasteur', xp: getTotalXpForLevel(860), description: 'Microbiologie - Vaccination et pasteurisation', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/e7/Louis_Pasteur.jpg' },
        { name: 'Rosalind Franklin', xp: getTotalXpForLevel(855), description: 'Structure de l\'ADN - Cristallographie aux rayons X', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/eb/Rosalind_Franklin_%281920-1958%29.jpg' },
        { name: 'Carl Sagan', xp: getTotalXpForLevel(850), description: 'Cosmos - Vulgarisation de l\'astronomie', avatar: 'https://upload.wikimedia.org/wikipedia/commons/b/be/Carl_Sagan_Planetary_Society.JPG' },
        { name: 'Richard Feynman', xp: getTotalXpForLevel(845), description: 'Physique quantique - Prix Nobel de physique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/1/1a/RichardFeynman-PaineMansionWoods1984_copyrightTamikoThiel_bw.jpg' },
        { name: 'Jane Goodall', xp: getTotalXpForLevel(840), description: 'Primatologie - √âtude des chimpanz√©s', avatar: 'https://upload.wikimedia.org/wikipedia/commons/f/f3/Jane_Goodall_2015.jpg' },
        { name: 'Archim√®de', xp: getTotalXpForLevel(835), description: 'Math√©matiques anciennes - Eur√™ka !', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/e7/Domenico-Fetti_Archimedes_1620.jpg' },
        { name: 'Johannes Kepler', xp: getTotalXpForLevel(830), description: 'Lois du mouvement plan√©taire - Astronomie moderne', avatar: 'https://upload.wikimedia.org/wikipedia/commons/d/d4/Johannes_Kepler_1610.jpg' },
        { name: 'Max Planck', xp: getTotalXpForLevel(825), description: 'P√®re de la physique quantique - Constante de Planck', avatar: 'https://upload.wikimedia.org/wikipedia/commons/c/c7/Max_Planck_1933.jpg' },
        { name: 'Neil deGrasse Tyson', xp: getTotalXpForLevel(820), description: 'Astrophysicien - Vulgarisation moderne', avatar: 'https://upload.wikimedia.org/wikipedia/commons/8/82/Neil_deGrasse_Tyson_in_June_2017_%28cropped%29.jpg' },
        { name: 'Dmitri Mendele√Øev', xp: getTotalXpForLevel(815), description: 'Tableau p√©riodique des √©l√©ments - Chimie moderne', avatar: 'https://upload.wikimedia.org/wikipedia/commons/c/c2/Mendeleev_Chairs.jpg' }
    ],
    
    'tech': [
        { name: 'Steve Jobs', xp: getTotalXpForLevel(850), description: 'Fondateur d\'Apple - R√©volution digitale', avatar: 'https://upload.wikimedia.org/wikipedia/commons/d/dc/Steve_Jobs_Headshot_2010-CROP_%28cropped_2%29.jpg' },
        { name: 'Bill Gates', xp: getTotalXpForLevel(840), description: 'Fondateur de Microsoft - Philanthrope mondial', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/a8/Bill_Gates_2017_%28cropped%29.jpg' },
        { name: 'Elon Musk', xp: getTotalXpForLevel(830), description: 'Tesla et SpaceX - Innovation technologique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/34/Elon_Musk_Royal_Society_%28crop2%29.jpg' },
        { name: 'Mark Zuckerberg', xp: getTotalXpForLevel(820), description: 'Fondateur de Facebook - R√©volution des r√©seaux sociaux', avatar: 'https://upload.wikimedia.org/wikipedia/commons/1/18/Mark_Zuckerberg_F8_2019_Keynote_%2832830578717%29_%28cropped%29.jpg' },
        { name: 'Tim Berners-Lee', xp: getTotalXpForLevel(810), description: 'Inventeur du World Wide Web - Internet moderne', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/9d/Sir_Tim_Berners-Lee.jpg' },
        { name: 'Alan Turing', xp: getTotalXpForLevel(805), description: 'P√®re de l\'informatique - D√©crypteur Enigma', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/a1/Alan_Turing_Aged_16.jpg' },
        { name: 'Jeff Bezos', xp: getTotalXpForLevel(800), description: 'Fondateur d\'Amazon - E-commerce mondial', avatar: 'https://upload.wikimedia.org/wikipedia/commons/6/6c/Jeff_Bezos_at_Amazon_Spheres_Grand_Opening_in_Seattle_-_2018_%2839074799225%29_%28cropped%29.jpg' },
        { name: 'Larry Page', xp: getTotalXpForLevel(795), description: 'Co-fondateur de Google - R√©volution de la recherche', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/ec/Larry_Page_in_the_European_Parliament%2C_17.06.2009.jpg' },
        { name: 'Sergey Brin', xp: getTotalXpForLevel(790), description: 'Co-fondateur de Google - Algorithme PageRank', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/a4/Sergey_Brin_cropped.jpg' },
        { name: 'Steve Wozniak', xp: getTotalXpForLevel(785), description: 'Co-fondateur d\'Apple - G√©nie de l\'ing√©nierie', avatar: 'https://upload.wikimedia.org/wikipedia/commons/f/f6/Steve_Wozniak_by_Gage_Skidmore_3.jpg' },
        { name: 'Linus Torvalds', xp: getTotalXpForLevel(780), description: 'Cr√©ateur de Linux - Open source r√©volutionnaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/6/69/Linus_Torvalds.jpeg' },
        { name: 'Jack Dorsey', xp: getTotalXpForLevel(775), description: 'Fondateur de Twitter - R√©volution du microblogging', avatar: 'https://upload.wikimedia.org/wikipedia/commons/2/28/Jack_Dorsey_2014_%28cropped%29.jpg' },
        { name: 'Tim Cook', xp: getTotalXpForLevel(770), description: 'CEO d\'Apple - Leadership technologique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/f/fa/Tim_Cook_2009_cropped.jpg' },
        { name: 'Satya Nadella', xp: getTotalXpForLevel(765), description: 'CEO de Microsoft - Transformation cloud', avatar: 'https://upload.wikimedia.org/wikipedia/commons/7/78/Satya_Nadella_2017_%28cropped%29.jpg' },
        { name: 'Reed Hastings', xp: getTotalXpForLevel(760), description: 'Fondateur de Netflix - Streaming r√©volutionnaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/6/69/Reed_Hastings_2014_%28cropped%29.jpg' },
        { name: 'Sam Altman', xp: getTotalXpForLevel(755), description: 'CEO d\'OpenAI - R√©volution de l\'IA g√©n√©rative', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/34/Sam_Altman_TechCrunch_2019.jpg' },
        { name: 'Sundar Pichai', xp: getTotalXpForLevel(750), description: 'CEO de Google - Innovation continue', avatar: 'https://upload.wikimedia.org/wikipedia/commons/d/d3/Sundar_Pichai_-_2023_%28cropped%29.jpg' },
        { name: 'Jack Ma', xp: getTotalXpForLevel(745), description: 'Fondateur d\'Alibaba - E-commerce chinois', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/ae/Jack_Ma_2014.jpg' },
        { name: 'Brian Chesky', xp: getTotalXpForLevel(740), description: 'Fondateur d\'Airbnb - √âconomie du partage', avatar: 'https://upload.wikimedia.org/wikipedia/commons/1/19/Brian_Chesky_2013.jpg' },
        { name: 'Travis Kalanick', xp: getTotalXpForLevel(735), description: 'Fondateur d\'Uber - Disruption des transports', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/3e/Travis_Kalanick_2013_%28cropped%29.jpg' }
    ],
    
    'sports': [
        { name: 'Lionel Messi', xp: getTotalXpForLevel(765), description: '8 Ballons d\'Or - GOAT du football moderne', avatar: 'https://upload.wikimedia.org/wikipedia/commons/b/b4/Lionel-Messi-Argentina-2022-FIFA-World-Cup_%28cropped%29.jpg' },
        { name: 'Cristiano Ronaldo', xp: getTotalXpForLevel(760), description: '5 Ballons d\'Or - L√©gende du football', avatar: 'https://upload.wikimedia.org/wikipedia/commons/8/8c/Cristiano_Ronaldo_2018.jpg' },
        { name: 'Michael Jordan', xp: getTotalXpForLevel(755), description: '6 fois champion NBA - GOAT du basketball', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/ae/Michael_Jordan_in_2014.jpg' },
        { name: 'Muhammad Ali', xp: getTotalXpForLevel(750), description: 'The Greatest - L√©gende de la boxe', avatar: 'https://upload.wikimedia.org/wikipedia/commons/8/89/Muhammad_Ali_NYWTS.jpg' },
        { name: 'Pel√©', xp: getTotalXpForLevel(745), description: '3 Coupes du Monde - Roi du football', avatar: 'https://upload.wikimedia.org/wikipedia/commons/5/5e/Pele_con_brasil.jpg' },
        { name: 'Serena Williams', xp: getTotalXpForLevel(740), description: '23 Grand Chelem - Reine du tennis', avatar: 'https://upload.wikimedia.org/wikipedia/commons/4/4b/Serena_Williams_at_2013_US_Open.jpg' },
        { name: 'Usain Bolt', xp: getTotalXpForLevel(735), description: 'Homme le plus rapide du monde - 8x champion olympique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/a7/Usain_Bolt_smiling_Berlin_2009.jpg' },
        { name: 'Roger Federer', xp: getTotalXpForLevel(730), description: '20 Grand Chelem - Maestro du tennis', avatar: 'https://upload.wikimedia.org/wikipedia/commons/f/f4/Roger_Federer_%2826449879643%29_%28cropped%29.jpg' },
        { name: 'Diego Maradona', xp: getTotalXpForLevel(725), description: 'Main de Dieu - L√©gende argentine', avatar: 'https://upload.wikimedia.org/wikipedia/commons/2/2c/Maradona-Mundial_86_con_la_copa.JPEG' },
        { name: 'Michael Phelps', xp: getTotalXpForLevel(720), description: '28 m√©dailles olympiques - GOAT de la natation', avatar: 'https://upload.wikimedia.org/wikipedia/commons/4/4c/Michael_Phelps_Rio_Olympics_2016.jpg' },
        { name: 'Kobe Bryant', xp: getTotalXpForLevel(715), description: '5 titres NBA - Mamba Mentality', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/96/Kobe_Bryant_8.jpg' },
        { name: 'LeBron James', xp: getTotalXpForLevel(710), description: '4 titres NBA - King James', avatar: 'https://upload.wikimedia.org/wikipedia/commons/7/7a/LeBron_James_%2851959977144%29_%28cropped2%29.jpg' },
        { name: 'Tiger Woods', xp: getTotalXpForLevel(705), description: '15 Majeurs - R√©volution du golf', avatar: 'https://upload.wikimedia.org/wikipedia/commons/b/b4/Tiger_Woods_in_May_2019.jpg' },
        { name: 'Rafael Nadal', xp: getTotalXpForLevel(700), description: '22 Grand Chelem - Roi de Roland-Garros', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/9d/Rafael_Nadal_10%2C_Aegon_Championships%2C_London%2C_UK_-_Diliff.jpg' },
        { name: 'Novak Djokovic', xp: getTotalXpForLevel(695), description: '24 Grand Chelem - Records absolus', avatar: 'https://upload.wikimedia.org/wikipedia/commons/8/84/Novak_Djokovic_Trophy_Wimbledon_2019.jpg' },
        { name: 'Zinedine Zidane', xp: getTotalXpForLevel(690), description: 'Coup de t√™te l√©gendaire - Ma√Ætre du football', avatar: 'https://upload.wikimedia.org/wikipedia/commons/f/f3/Zinedine_Zidane_2008.jpg' },
        { name: 'Mike Tyson', xp: getTotalXpForLevel(685), description: 'Iron Mike - Plus jeune champion du monde poids lourd', avatar: 'https://upload.wikimedia.org/wikipedia/commons/5/54/Mike_Tyson_2019_%28cropped%29.jpg' },
        { name: 'Tom Brady', xp: getTotalXpForLevel(680), description: '7 Super Bowl - GOAT du football am√©ricain', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/3b/Tom_Brady_2021.jpg' },
        { name: 'Wayne Gretzky', xp: getTotalXpForLevel(675), description: 'The Great One - L√©gende du hockey', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/3c/Wayne_Gretzky_2006.jpg' },
        { name: 'Simone Biles', xp: getTotalXpForLevel(670), description: 'Gymnastique - 7 m√©dailles olympiques', avatar: 'https://upload.wikimedia.org/wikipedia/commons/f/f5/Simone_Biles_2016.jpg' },
        { name: 'Neymar Jr', xp: getTotalXpForLevel(665), description: 'Magicien br√©silien - Star mondiale', avatar: 'https://upload.wikimedia.org/wikipedia/commons/b/bb/Neymar_Jr._with_Al_Hilal%2C_3_October_2023_-_03_%28cropped%29.jpg' },
        { name: 'Kylian Mbapp√©', xp: getTotalXpForLevel(660), description: 'Champion du Monde 2018 - Ph√©nom√®ne fran√ßais', avatar: 'https://upload.wikimedia.org/wikipedia/commons/7/79/Kylian_Mbapp%C3%A9_2022_%28cropped%29.jpg' },
        { name: 'Floyd Mayweather', xp: getTotalXpForLevel(655), description: 'Money - 50-0 invincible', avatar: 'https://upload.wikimedia.org/wikipedia/commons/c/c5/Floyd_Mayweather_2018.jpg' },
        { name: 'Shaquille O\'Neal', xp: getTotalXpForLevel(650), description: 'Shaq - Domination physique NBA', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/9e/Shaquille_O%27Neal_2012.jpg' },
        { name: 'Lewis Hamilton', xp: getTotalXpForLevel(645), description: '7 titres F1 - Champion de tous les temps', avatar: 'https://upload.wikimedia.org/wikipedia/commons/1/18/Lewis_Hamilton_2016_Malaysia_2.jpg' }
    ],
    
    'arts': [
        { name: 'Leonardo da Vinci', xp: getTotalXpForLevel(880), description: 'G√©nie de la Renaissance - Art et science', avatar: 'https://upload.wikimedia.org/wikipedia/commons/b/ba/Leonardo_self.jpg' },
        { name: 'Pablo Picasso', xp: getTotalXpForLevel(870), description: 'Cubisme - R√©volution artistique du XXe si√®cle', avatar: 'https://upload.wikimedia.org/wikipedia/commons/b/b8/Portrait_de_Picasso%2C_1908.jpg' },
        { name: 'Vincent van Gogh', xp: getTotalXpForLevel(860), description: 'Post-impressionnisme - Ma√Ætre de la couleur', avatar: 'https://upload.wikimedia.org/wikipedia/commons/4/4c/Vincent_van_Gogh_-_Self-Portrait_-_Google_Art_Project_%28454045%29.jpg' },
        { name: 'Michel-Ange', xp: getTotalXpForLevel(850), description: 'Chapelle Sixtine - Sculpteur et peintre l√©gendaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/0/02/Michelangelo_Daniele_da_Volterra_%28dettaglio%29.jpg' },
        { name: 'Wolfgang Amadeus Mozart', xp: getTotalXpForLevel(840), description: 'Prodige musical - Compositeur l√©gendaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/1/1e/Wolfgang-amadeus-mozart_1.jpg' },
        { name: 'Ludwig van Beethoven', xp: getTotalXpForLevel(830), description: 'Symphonies immortelles - G√©nie de la musique classique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/6/6f/Beethoven.jpg' },
        { name: 'William Shakespeare', xp: getTotalXpForLevel(820), description: 'Plus grand dramaturge - Ma√Ætre de la litt√©rature', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/a2/Shakespeare.jpg' },
        { name: 'Frida Kahlo', xp: getTotalXpForLevel(810), description: 'Ic√¥ne du surr√©alisme - Art et f√©minisme', avatar: 'https://upload.wikimedia.org/wikipedia/commons/0/06/Frida_Kahlo%2C_by_Guillermo_Kahlo.jpg' },
        { name: 'Claude Monet', xp: getTotalXpForLevel(800), description: 'Impressionnisme - Ma√Ætre de la lumi√®re', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/a4/Claude_Monet_1899_Nadar_crop.jpg' },
        { name: 'Rembrandt', xp: getTotalXpForLevel(790), description: 'Ma√Ætre hollandais - Clair-obscur magistral', avatar: 'https://upload.wikimedia.org/wikipedia/commons/b/bd/Rembrandt_van_Rijn_-_Self-Portrait_-_Google_Art_Project.jpg' },
        { name: 'Salvador Dal√≠', xp: getTotalXpForLevel(780), description: 'Surr√©alisme - G√©nie excentrique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/2/27/Salvador_Dali_NYWTS.jpg' },
        { name: 'Johann Sebastian Bach', xp: getTotalXpForLevel(770), description: 'Ma√Ætre du baroque - Contrepoint parfait', avatar: 'https://upload.wikimedia.org/wikipedia/commons/6/6a/Johann_Sebastian_Bach.jpg' },
        { name: 'Andy Warhol', xp: getTotalXpForLevel(760), description: 'Pop Art - Factory et culture de masse', avatar: 'https://upload.wikimedia.org/wikipedia/commons/4/42/Andy_Warhol_1975.jpg' },
        { name: 'Bob Dylan', xp: getTotalXpForLevel(750), description: 'Prix Nobel de litt√©rature - L√©gende folk rock', avatar: 'https://upload.wikimedia.org/wikipedia/commons/0/02/Bob_Dylan_-_Azkena_Rock_Festival_2010_2.jpg' },
        { name: 'The Beatles', xp: getTotalXpForLevel(745), description: 'Groupe le plus influent - R√©volution musicale', avatar: 'https://upload.wikimedia.org/wikipedia/commons/d/df/The_Fabs.JPG' },
        { name: 'Elvis Presley', xp: getTotalXpForLevel(740), description: 'King of Rock and Roll - Ic√¥ne culturelle', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/99/Elvis_Presley_promoting_Jailhouse_Rock.jpg' },
        { name: 'Michael Jackson', xp: getTotalXpForLevel(735), description: 'King of Pop - Moonwalk l√©gendaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/31/Michael_Jackson_in_1988.jpg' },
        { name: 'Freddie Mercury', xp: getTotalXpForLevel(730), description: 'Queen - Voix l√©gendaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/ef/Freddie_Mercury_performing_in_New_Haven%2C_CT%2C_November_1977.jpg' },
        { name: 'David Bowie', xp: getTotalXpForLevel(725), description: 'Cam√©l√©on du rock - Ic√¥ne innovante', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/e8/David-Bowie_Chicago_2002-08-08_photoby_Adam-Bielawski-cropped.jpg' },
        { name: 'Prince', xp: getTotalXpForLevel(720), description: 'Purple Rain - G√©nie musical', avatar: 'https://upload.wikimedia.org/wikipedia/commons/5/5c/Prince_at_Coachella_001.jpg' },
        { name: 'Banksy', xp: getTotalXpForLevel(715), description: 'Street art myst√©rieux - Activisme artistique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/f/f9/Banksy.jpg' }
    ],
    
    'business': [
        { name: 'Warren Buffett', xp: getTotalXpForLevel(800), description: 'Oracle d\'Omaha - Ma√Ætre de l\'investissement', avatar: 'https://upload.wikimedia.org/wikipedia/commons/5/51/Warren_Buffett_KU_Visit.jpg' },
        { name: 'Henry Ford', xp: getTotalXpForLevel(790), description: 'R√©volution industrielle - Production de masse', avatar: 'https://upload.wikimedia.org/wikipedia/commons/1/18/Henry_ford_1919.jpg' },
        { name: 'John D. Rockefeller', xp: getTotalXpForLevel(780), description: 'Premier milliardaire - Empire p√©trolier', avatar: 'https://upload.wikimedia.org/wikipedia/commons/6/6a/John_D._Rockefeller_1885.jpg' },
        { name: 'Oprah Winfrey', xp: getTotalXpForLevel(770), description: 'Magnat des m√©dias - Philanthrope influente', avatar: 'https://upload.wikimedia.org/wikipedia/commons/b/b8/Oprah_in_2014.jpg' },
        { name: 'Richard Branson', xp: getTotalXpForLevel(760), description: 'Fondateur de Virgin - Entrepreneur aventurier', avatar: 'https://upload.wikimedia.org/wikipedia/commons/2/2c/Richard_Branson_March_2015_%28cropped%29.jpg' },
        { name: 'Andrew Carnegie', xp: getTotalXpForLevel(750), description: 'Magnat de l\'acier - Philanthrope l√©gendaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/a4/Andrew_Carnegie%2C_three-quarter_length_portrait%2C_seated%2C_facing_slightly_left%2C_1913.jpg' },
        { name: 'J.P. Morgan', xp: getTotalXpForLevel(740), description: 'Banquier l√©gendaire - Finance moderne', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/3e/John_Pierpont_Morgan.jpg' },
        { name: 'Bernard Arnault', xp: getTotalXpForLevel(730), description: 'LVMH - Empire du luxe', avatar: 'https://upload.wikimedia.org/wikipedia/commons/d/da/Bernard_Arnault_%283%29_-_2017_%28cropped%29.jpg' },
        { name: 'Carlos Slim', xp: getTotalXpForLevel(720), description: 'Magnat des t√©l√©coms - Homme le plus riche du Mexique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/2/2d/Carlos_Slim_%2845680472234%29_%28cropped%29.jpg' },
        { name: 'Ray Kroc', xp: getTotalXpForLevel(710), description: 'McDonald\'s - Fast-food mondial', avatar: 'https://upload.wikimedia.org/wikipedia/commons/c/cf/Ray_Kroc%2C_McDonald%27s_CEO.jpg' },
        { name: 'Coco Chanel', xp: getTotalXpForLevel(700), description: 'R√©volution de la mode - Chanel N¬∞5', avatar: 'https://upload.wikimedia.org/wikipedia/commons/c/ce/Coco_Chanel%2C_1920.jpg' },
        { name: 'Sam Walton', xp: getTotalXpForLevel(690), description: 'Fondateur de Walmart - Retail r√©volutionnaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/f/fb/Sam_Walton.jpg' },
        { name: 'Amancio Ortega', xp: getTotalXpForLevel(680), description: 'Fondateur de Zara - Fast fashion', avatar: 'https://upload.wikimedia.org/wikipedia/commons/0/09/Amancio_Ortega_2015_%28cropped%29.jpg' }
    ],
    
    'politique': [
        { name: 'Nelson Mandela', xp: getTotalXpForLevel(890), description: 'Lutte contre l\'apartheid - Prix Nobel de la paix', avatar: 'https://upload.wikimedia.org/wikipedia/commons/0/02/Nelson_Mandela_1994.jpg' },
        { name: 'Mahatma Gandhi', xp: getTotalXpForLevel(885), description: 'Non-violence - Ind√©pendance de l\'Inde', avatar: 'https://upload.wikimedia.org/wikipedia/commons/7/7a/Mahatma-Gandhi%2C_studio%2C_1931.jpg' },
        { name: 'Winston Churchill', xp: getTotalXpForLevel(875), description: 'Leadership WWII - Premier ministre britannique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/9c/Sir_Winston_Churchill_-_19086236948.jpg' },
        { name: 'Martin Luther King Jr.', xp: getTotalXpForLevel(870), description: 'Droits civiques - I Have a Dream', avatar: 'https://upload.wikimedia.org/wikipedia/commons/0/05/Martin_Luther_King%2C_Jr..jpg' },
        { name: 'Abraham Lincoln', xp: getTotalXpForLevel(865), description: 'Abolition de l\'esclavage - Pr√©sident am√©ricain l√©gendaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/ab/Abraham_Lincoln_O-77_matte_collodion_print.jpg' },
        { name: 'Angela Merkel', xp: getTotalXpForLevel(855), description: 'Chanceli√®re allemande - Leader europ√©enne', avatar: 'https://upload.wikimedia.org/wikipedia/commons/2/21/Angela_Merkel_2019_%28cropped%29.jpg' },
        { name: 'Franklin D. Roosevelt', xp: getTotalXpForLevel(850), description: 'New Deal - 4 mandats pr√©sidentiels', avatar: 'https://upload.wikimedia.org/wikipedia/commons/b/b8/FDR_in_1933.jpg' },
        { name: 'Charles de Gaulle', xp: getTotalXpForLevel(845), description: 'R√©sistance fran√ßaise - Fondateur de la Ve R√©publique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/eb/Charles_de_Gaulle-1963.jpg' },
        { name: 'Margaret Thatcher', xp: getTotalXpForLevel(840), description: 'Dame de fer - Premier ministre britannique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/32/Margaret_Thatcher_cropped1.png' },
        { name: 'Barack Obama', xp: getTotalXpForLevel(835), description: 'Premier pr√©sident noir am√©ricain - Hope & Change', avatar: 'https://upload.wikimedia.org/wikipedia/commons/8/8d/President_Barack_Obama.jpg' },
        { name: 'John F. Kennedy', xp: getTotalXpForLevel(830), description: 'Nouvelle fronti√®re - Pr√©sident charismatique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/c/c3/John_F._Kennedy%2C_White_House_color_photo_portrait.jpg' },
        { name: 'Vladimir Poutine', xp: getTotalXpForLevel(820), description: 'Leader russe - Influence g√©opolitique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/6/6a/Vladimir_Putin_17-11-2021_%28cropped%29.jpg' },
        { name: 'Xi Jinping', xp: getTotalXpForLevel(815), description: 'Pr√©sident chinois - Nouvelle route de la soie', avatar: 'https://upload.wikimedia.org/wikipedia/commons/2/27/Xi_Jinping_2019.jpg' },
        { name: 'Jacinda Ardern', xp: getTotalXpForLevel(810), description: 'Premier ministre NZ - Leadership empathique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/0/0a/Jacinda_Ardern_August_2023.jpg' }
    ],
    
    'exploration': [
        { name: 'Neil Armstrong', xp: getTotalXpForLevel(850), description: 'Premier homme sur la Lune - Explorateur spatial', avatar: 'https://upload.wikimedia.org/wikipedia/commons/0/0d/Neil_Armstrong_pose.jpg' },
        { name: 'Youri Gagarine', xp: getTotalXpForLevel(840), description: 'Premier homme dans l\'espace - H√©ros sovi√©tique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/ea/Gagarin_in_Sweden.jpg' },
        { name: 'Jacques Cousteau', xp: getTotalXpForLevel(830), description: 'Pionnier de l\'oc√©anographie - D√©fenseur des mers', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/a3/Cousteau.jpg' },
        { name: 'Edmund Hillary', xp: getTotalXpForLevel(820), description: 'Premier √† conqu√©rir l\'Everest - Alpiniste l√©gendaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/4/42/Edmund_Hillary%2C_c._1953%2C_cropped.jpg' },
        { name: 'Christophe Colomb', xp: getTotalXpForLevel(810), description: 'D√©couverte des Am√©riques - Explorateur historique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/5/5f/Ridolfo_Ghirlandaio_Columbus.jpg' },
        { name: 'Amelia Earhart', xp: getTotalXpForLevel(800), description: 'Pionni√®re de l\'aviation - Premi√®re femme pilote transatlantique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/ee/Amelia_Earhart_1935.jpg' },
        { name: 'Ernest Shackleton', xp: getTotalXpForLevel(790), description: 'Exp√©dition Endurance - H√©ros de l\'Antarctique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/c/c1/Sir_Ernest_Shackleton.jpg' },
        { name: 'Marco Polo', xp: getTotalXpForLevel(780), description: 'Route de la soie - Explorateur v√©nitien', avatar: 'https://upload.wikimedia.org/wikipedia/commons/4/4c/Marco_Polo_portrait.jpg' },
        { name: 'Buzz Aldrin', xp: getTotalXpForLevel(770), description: 'Deuxi√®me homme sur la Lune - Astronaute l√©gendaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/a4/Buzz_Aldrin.jpg' },
        { name: 'Roald Amundsen', xp: getTotalXpForLevel(760), description: 'Premier au p√¥le Sud - Explorateur polaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/1/1f/Roald_Amundsen_%28crop%29.jpg' }
    ],
    
    'cinema': [
        { name: 'Charlie Chaplin', xp: getTotalXpForLevel(840), description: 'G√©nie du cin√©ma muet - The Tramp', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/3b/Charlie_Chaplin_portrait.jpg' },
        { name: 'Steven Spielberg', xp: getTotalXpForLevel(820), description: 'Ma√Ætre du blockbuster - R√©alisateur l√©gendaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/6/67/Steven_Spielberg_by_Gage_Skidmore.jpg' },
        { name: 'Alfred Hitchcock', xp: getTotalXpForLevel(810), description: 'Ma√Ætre du suspense - R√©alisateur iconique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/94/Hitchcock%2C_Alfred_02.jpg' },
        { name: 'Marilyn Monroe', xp: getTotalXpForLevel(800), description: 'Ic√¥ne d\'Hollywood - Star l√©gendaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/0/0d/Marilyn_Monroe_in_1952.jpg' },
        { name: 'Stanley Kubrick', xp: getTotalXpForLevel(790), description: 'Visionnaire du cin√©ma - 2001 A Space Odyssey', avatar: 'https://upload.wikimedia.org/wikipedia/commons/f/fa/Kubrick_on_the_set_of_Barry_Lyndon_%281975_publicity_photo%29.jpg' },
        { name: 'Martin Scorsese', xp: getTotalXpForLevel(780), description: 'Ma√Ætre du cin√©ma am√©ricain - Goodfellas', avatar: 'https://upload.wikimedia.org/wikipedia/commons/6/63/Martin_Scorsese_by_David_Shankbone.jpg' },
        { name: 'Francis Ford Coppola', xp: getTotalXpForLevel(770), description: 'Le Parrain - Trilogie l√©gendaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/0/05/Francis_Ford_Coppola_2011_CC.jpg' },
        { name: 'Quentin Tarantino', xp: getTotalXpForLevel(760), description: 'Pulp Fiction - Dialogues cultes', avatar: 'https://upload.wikimedia.org/wikipedia/commons/0/0b/Quentin_Tarantino_by_Gage_Skidmore.jpg' },
        { name: 'Christopher Nolan', xp: getTotalXpForLevel(750), description: 'Inception - Ma√Ætre du mind-bending', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/95/Christopher_Nolan_Cannes_2018.jpg' },
        { name: 'Audrey Hepburn', xp: getTotalXpForLevel(740), description: 'Breakfast at Tiffany\'s - √âl√©gance incarn√©e', avatar: 'https://upload.wikimedia.org/wikipedia/commons/1/19/Audrey_Hepburn_1956.jpg' },
        { name: 'Clint Eastwood', xp: getTotalXpForLevel(730), description: 'Western et r√©alisation - Ic√¥ne am√©ricaine', avatar: 'https://upload.wikimedia.org/wikipedia/commons/7/7e/Clint_Eastwood_at_2010_New_York_Film_Festival.jpg' },
        { name: 'Meryl Streep', xp: getTotalXpForLevel(720), description: '3 Oscars - Plus grande actrice', avatar: 'https://upload.wikimedia.org/wikipedia/commons/4/40/Meryl_Streep_December_2014.jpg' },
        { name: 'Robert De Niro', xp: getTotalXpForLevel(710), description: 'Taxi Driver - Acteur l√©gendaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/e5/Robert_De_Niro_Cannes_2016.jpg' },
        { name: 'Akira Kurosawa', xp: getTotalXpForLevel(700), description: 'Cin√©ma japonais - Les Sept Samoura√Øs', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/9b/Akira_Kurosawa_1976.jpg' }
    ],
    
    'mode': [
        { name: 'Coco Chanel', xp: getTotalXpForLevel(830), description: 'R√©volution de la mode f√©minine - Chanel N¬∞5', avatar: 'https://upload.wikimedia.org/wikipedia/commons/c/ce/Coco_Chanel%2C_1920.jpg' },
        { name: 'Yves Saint Laurent', xp: getTotalXpForLevel(815), description: 'Haute couture - Smoking pour femmes', avatar: 'https://upload.wikimedia.org/wikipedia/commons/6/66/Yves_Saint_Laurent_%281970s%29.jpg' },
        { name: 'Giorgio Armani', xp: getTotalXpForLevel(800), description: '√âl√©gance italienne - Empire de la mode', avatar: 'https://upload.wikimedia.org/wikipedia/commons/c/c7/Giorgio_Armani_by_Ros_O%27Gorman.jpg' },
        { name: 'Karl Lagerfeld', xp: getTotalXpForLevel(790), description: 'Kaiser de la mode - Directeur artistique Chanel', avatar: 'https://upload.wikimedia.org/wikipedia/commons/d/d3/Karl_Lagerfeld_2014.jpg' },
        { name: 'Christian Dior', xp: getTotalXpForLevel(780), description: 'New Look - R√©volution post-guerre', avatar: 'https://upload.wikimedia.org/wikipedia/commons/7/78/Christian_Dior_%281952%29.jpg' },
        { name: 'Gianni Versace', xp: getTotalXpForLevel(770), description: 'Luxe et glamour - Style iconique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/8/8b/Gianni_Versace_1993.jpg' },
        { name: 'Ralph Lauren', xp: getTotalXpForLevel(760), description: 'American dream - Polo et √©l√©gance', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/90/Ralph_Lauren_%28cropped%29.jpg' },
        { name: 'Donatella Versace', xp: getTotalXpForLevel(750), description: 'H√©ritage Versace - Ic√¥ne de la mode', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/39/Donatella_Versace_2015_%28cropped%29.jpg' },
        { name: 'Tom Ford', xp: getTotalXpForLevel(740), description: 'Gucci et luxe moderne - Designer star', avatar: 'https://upload.wikimedia.org/wikipedia/commons/1/1d/Tom_Ford_2018.jpg' },
        { name: 'Alexander McQueen', xp: getTotalXpForLevel(730), description: 'Avant-garde - G√©nie cr√©atif', avatar: 'https://upload.wikimedia.org/wikipedia/commons/c/c4/Alexander_McQueen_%282009%29.jpg' }
    ],
    
    'philosophie': [
        { name: 'Socrate', xp: getTotalXpForLevel(895), description: 'P√®re de la philosophie - Ma√Øeutique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/a4/Socrates_Louvre.jpg' },
        { name: 'Platon', xp: getTotalXpForLevel(890), description: 'Philosophe grec - Th√©orie des Id√©es', avatar: 'https://upload.wikimedia.org/wikipedia/commons/d/da/Plato_Pio-Clementino_Inv305.jpg' },
        { name: 'Aristote', xp: getTotalXpForLevel(885), description: 'Logique et m√©taphysique - P√®re de la science', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/ae/Aristotle_Altemps_Inv8575.jpg' },
        { name: 'Friedrich Nietzsche', xp: getTotalXpForLevel(875), description: 'Surhomme - Philosophie de la vie', avatar: 'https://upload.wikimedia.org/wikipedia/commons/1/1b/Nietzsche187a.jpg' },
        { name: 'Confucius', xp: getTotalXpForLevel(870), description: 'Sagesse chinoise - √âthique et morale', avatar: 'https://upload.wikimedia.org/wikipedia/commons/0/07/Konfuzius-1770.jpg' },
        { name: 'Immanuel Kant', xp: getTotalXpForLevel(865), description: 'Critique de la raison pure - Philosophie transcendantale', avatar: 'https://upload.wikimedia.org/wikipedia/commons/f/f2/Kant_gemaelde_3.jpg' },
        { name: 'Jean-Jacques Rousseau', xp: getTotalXpForLevel(860), description: 'Contrat social - Philosophie des Lumi√®res', avatar: 'https://upload.wikimedia.org/wikipedia/commons/b/b7/Jean-Jacques_Rousseau_%28painted_portrait%29.jpg' },
        { name: 'Ren√© Descartes', xp: getTotalXpForLevel(855), description: 'Cogito ergo sum - Rationalisme', avatar: 'https://upload.wikimedia.org/wikipedia/commons/7/73/Frans_Hals_-_Portret_van_Ren%C3%A9_Descartes.jpg' },
        { name: 'Karl Marx', xp: getTotalXpForLevel(850), description: 'Philosophie politique - Mat√©rialisme historique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/d/d4/Karl_Marx_001.jpg' },
        { name: 'Simone de Beauvoir', xp: getTotalXpForLevel(845), description: 'F√©minisme - Le Deuxi√®me Sexe', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/ef/Simone_de_Beauvoir.jpg' },
        { name: 'Jean-Paul Sartre', xp: getTotalXpForLevel(840), description: 'Existentialisme - L\'existence pr√©c√®de l\'essence', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/ef/Sartre_1967_crop.jpg' }
    ],
    
    'litterature': [
        { name: 'William Shakespeare', xp: getTotalXpForLevel(875), description: 'Plus grand dramaturge - Hamlet et Rom√©o', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/a2/Shakespeare.jpg' },
        { name: 'Victor Hugo', xp: getTotalXpForLevel(860), description: 'Les Mis√©rables - G√©nie romantique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/e6/Victor_Hugo_by_%C3%89tienne_Carjat_1876.jpg' },
        { name: 'L√©on Tolsto√Ø', xp: getTotalXpForLevel(855), description: 'Guerre et Paix - Ma√Ætre russe', avatar: 'https://upload.wikimedia.org/wikipedia/commons/c/c6/L.N.Tolstoy_Prokudin-Gorsky.jpg' },
        { name: 'Fiodor Dosto√Øevski', xp: getTotalXpForLevel(850), description: 'Crime et Ch√¢timent - Psychologie profonde', avatar: 'https://upload.wikimedia.org/wikipedia/commons/7/78/Vasily_Perov_-_%D0%9F%D0%BE%D1%80%D1%82%D1%80%D0%B5%D1%82_%D0%A4.%D0%9C.%D0%94%D0%BE%D1%81%D1%82%D0%BE%D0%B5%D0%B2%D1%81%D0%BA%D0%BE%D0%B3%D0%BE_-_Google_Art_Project.jpg' },
        { name: 'Ernest Hemingway', xp: getTotalXpForLevel(840), description: 'Prix Nobel - Style minimaliste', avatar: 'https://upload.wikimedia.org/wikipedia/commons/2/28/ErnestHemingway.jpg' },
        { name: 'Gabriel Garc√≠a M√°rquez', xp: getTotalXpForLevel(835), description: 'Cent ans de solitude - R√©alisme magique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/0/0f/Gabriel_Garcia_Marquez.jpg' },
        { name: 'Franz Kafka', xp: getTotalXpForLevel(830), description: 'La M√©tamorphose - Absurde et ali√©nation', avatar: 'https://upload.wikimedia.org/wikipedia/commons/d/d9/Kafka_portrait.jpg' },
        { name: 'J.R.R. Tolkien', xp: getTotalXpForLevel(820), description: 'Le Seigneur des Anneaux - Fantasy √©pique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/d/d4/J._R._R._Tolkien%2C_ca._1925.jpg' },
        { name: 'George Orwell', xp: getTotalXpForLevel(815), description: '1984 - Dystopie proph√©tique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/7/7e/George_Orwell_press_photo.jpg' },
        { name: 'Jane Austen', xp: getTotalXpForLevel(810), description: 'Orgueil et Pr√©jug√©s - Romance classique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/c/cc/CassandraAusten-JaneAusten%28c.1810%29_hires.jpg' },
        { name: 'Mark Twain', xp: getTotalXpForLevel(805), description: 'Tom Sawyer - Humour am√©ricain', avatar: 'https://upload.wikimedia.org/wikipedia/commons/0/0c/Mark_Twain_by_AF_Bradley.jpg' },
        { name: 'Charles Dickens', xp: getTotalXpForLevel(800), description: 'Oliver Twist - Critique sociale', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/aa/Dickens_Gurney_head.jpg' }
    ]
};

const MOROCCAN_LEGENDS = [
    // Sports - Football
    { name: 'Hicham El Guerrouj', xp: getTotalXpForLevel(615), description: 'Champion d\'athl√©tisme - Records du monde 1500m et mile', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/9a/Hicham_El_Guerrouj.jpg' },
    { name: 'Nawal El Moutawakel', xp: getTotalXpForLevel(610), description: 'Premi√®re championne olympique africaine - 400m haies 1984', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/9f/Nawal_El_Moutawakel_1984.jpg' },
    { name: 'Achraf Hakimi', xp: getTotalXpForLevel(605), description: 'D√©fenseur PSG - Star des Lions de l\'Atlas', avatar: 'https://upload.wikimedia.org/wikipedia/commons/4/4d/Achraf_Hakimi_2022_%28cropped%29.jpg' },
    { name: 'Sa√Ød Aouita', xp: getTotalXpForLevel(600), description: 'Champion olympique 5000m - L√©gende de l\'athl√©tisme', avatar: 'https://upload.wikimedia.org/wikipedia/commons/7/7f/Said_Aouita_1984.jpg' },
    { name: 'Hakim Ziyech', xp: getTotalXpForLevel(595), description: 'Magicien marocain - Star de la s√©lection', avatar: 'https://upload.wikimedia.org/wikipedia/commons/5/5f/Hakim_Ziyech_2022.jpg' },
    { name: 'Yassine Bounou (Bono)', xp: getTotalXpForLevel(590), description: 'Gardien prodige - H√©ros Mondial 2022', avatar: 'https://upload.wikimedia.org/wikipedia/commons/b/b5/Yassine_Bounou_2022.jpg' },
    { name: 'Sofiane Boufal', xp: getTotalXpForLevel(585), description: 'Ailier technique - C√©l√©bration iconique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/e9/Sofiane_Boufal_2022.jpg' },
    { name: 'Mustapha Hadji', xp: getTotalXpForLevel(580), description: 'L√©gende marocaine - Coupe du Monde 1998', avatar: 'https://upload.wikimedia.org/wikipedia/commons/7/77/Mustapha_Hadji.jpg' },
    { name: 'Youssef En-Nesyri', xp: getTotalXpForLevel(575), description: 'Buteur redoutable - Attaquant des Lions', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/99/Youssef_En-Nesyri_2022.jpg' },
    { name: 'Noureddine Naybet', xp: getTotalXpForLevel(570), description: 'D√©fenseur de l√©gende - Capitaine historique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/e/e3/Noureddine_Naybet.jpg' },
    { name: 'Walid Regragui', xp: getTotalXpForLevel(565), description: 'S√©lectionneur - Demi-finale Mondial 2022', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/af/Walid_Regragui_2022.jpg' },
    
    // Arts & Culture
    { name: 'Gad Elmaleh', xp: getTotalXpForLevel(620), description: 'Humoriste international - Ambassadeur culturel', avatar: 'https://upload.wikimedia.org/wikipedia/commons/d/d7/Gad_Elmaleh_2012.jpg' },
    { name: 'Le√Øla Slimani', xp: getTotalXpForLevel(615), description: 'Prix Goncourt 2016 - √âcrivaine renomm√©e', avatar: 'https://upload.wikimedia.org/wikipedia/commons/4/4b/Leila_Slimani_2018.jpg' },
    { name: 'Tahar Ben Jelloun', xp: getTotalXpForLevel(610), description: 'Prix Goncourt 1987 - √âcrivain de renomm√©e mondiale', avatar: 'https://upload.wikimedia.org/wikipedia/commons/8/8b/Tahar_Ben_Jelloun_2015.jpg' },
    { name: 'Saad Lamjarred', xp: getTotalXpForLevel(595), description: 'Chanteur pop - Star du monde arabe', avatar: 'https://upload.wikimedia.org/wikipedia/commons/4/4c/Saad_Lamjarred_2015.jpg' },
    { name: 'Hindi Zahra', xp: getTotalXpForLevel(590), description: 'Chanteuse soul - Artiste internationale', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/9e/Hindi_Zahra_2014.jpg' },
    { name: 'Nass El Ghiwane', xp: getTotalXpForLevel(600), description: 'Groupe mythique - Rolling Stones d\'Afrique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/3e/Nass_El_Ghiwane.jpg' },
    { name: 'Majid Bekkas', xp: getTotalXpForLevel(585), description: 'Guitariste virtuose - Fusion gnawa-jazz', avatar: 'https://upload.wikimedia.org/wikipedia/commons/2/2f/Majid_Bekkas.jpg' },
    { name: 'Maati Bouabeid', xp: getTotalXpForLevel(580), description: 'Acteur l√©gendaire - Ic√¥ne du cin√©ma marocain', avatar: 'https://upload.wikimedia.org/wikipedia/commons/5/5c/Maati_Bouabeid.jpg' },
    
    // Politique & Histoire
    { name: 'Mohammed V', xp: getTotalXpForLevel(650), description: 'Lib√©rateur du Maroc - Symbole de l\'ind√©pendance', avatar: 'https://upload.wikimedia.org/wikipedia/commons/8/8d/King_Mohammed_V_of_Morocco.jpg' },
    { name: 'Hassan II', xp: getTotalXpForLevel(635), description: 'Roi b√¢tisseur - Modernisation du Maroc', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/3e/Hassan_II_of_Morocco.jpg' },
    { name: 'Mehdi Ben Barka', xp: getTotalXpForLevel(625), description: 'Leader politique - Figure du tiers-mondisme', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/9c/Mehdi_Ben_Barka.jpg' },
    { name: 'Allal El Fassi', xp: getTotalXpForLevel(615), description: 'Leader nationaliste - P√®re de l\'ind√©pendance', avatar: 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Allal_El_Fassi.jpg' },
    { name: 'Fatima Mernissi', xp: getTotalXpForLevel(605), description: 'Sociologue f√©ministe - Intellectuelle de renom', avatar: 'https://upload.wikimedia.org/wikipedia/commons/a/a5/Fatima_Mernissi.jpg' },
    
    // Business
    { name: 'Aziz Akhannouch', xp: getTotalXpForLevel(600), description: 'Homme d\'affaires - Chef du gouvernement', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/9c/Aziz_Akhannouch_2022.jpg' },
    { name: 'Othman Benjelloun', xp: getTotalXpForLevel(595), description: 'Banquier et industriel - BMCE Bank', avatar: 'https://upload.wikimedia.org/wikipedia/commons/3/35/Othman_Benjelloun.jpg' },
    { name: 'Miloud Chaabi', xp: getTotalXpForLevel(590), description: 'Self-made man - Ynna Holding', avatar: 'https://upload.wikimedia.org/wikipedia/commons/c/c8/Miloud_Chaabi.jpg' },
    { name: 'Mohamed Horani', xp: getTotalXpForLevel(585), description: 'Entrepreneur - Holmarcom Group', avatar: 'https://upload.wikimedia.org/wikipedia/commons/4/4a/Mohamed_Horani.jpg' },
    
    // Science & √âducation
    { name: 'Ibn Battuta', xp: getTotalXpForLevel(700), description: 'Plus grand explorateur m√©di√©val - 120 000 km parcourus', avatar: 'https://upload.wikimedia.org/wikipedia/commons/f/f3/Ibn_Battuta.jpg' },
    { name: 'Averro√®s (Ibn Rushd)', xp: getTotalXpForLevel(695), description: 'Philosophe et m√©decin - Pont entre Orient et Occident', avatar: 'https://upload.wikimedia.org/wikipedia/commons/8/88/Averroes.jpg' },
    { name: 'Ibn Khaldoun', xp: getTotalXpForLevel(690), description: 'P√®re de la sociologie - Al-Muqaddima', avatar: 'https://upload.wikimedia.org/wikipedia/commons/5/5f/Ibn_Khaldun.jpg' },
    { name: 'Al-Idrisi', xp: getTotalXpForLevel(680), description: 'G√©ographe m√©di√©val - Cartographie r√©volutionnaire', avatar: 'https://upload.wikimedia.org/wikipedia/commons/c/c0/Al-Idrisi.jpg' },
    { name: 'Rachid Yazami', xp: getTotalXpForLevel(630), description: 'Inventeur batterie lithium-ion - Pionnier technologique', avatar: 'https://upload.wikimedia.org/wikipedia/commons/9/98/Rachid_Yazami.jpg' },
    { name: 'Ahmed Zewail', xp: getTotalXpForLevel(640), description: 'Prix Nobel de Chimie 1999 - Femtochimie', avatar: 'https://upload.wikimedia.org/wikipedia/commons/d/d6/Ahmed_Zewail.jpg' }
];

    // ==================== INITIALIZATION ====================

    async function initializeLeaderboard() {
        console.log('üöÄ Initialisation du leaderboard...');
        console.log('üîë CSRF Token:', csrftoken ? '‚úÖ Pr√©sent' : '‚ùå Manquant');

        const profileData = await getProfileData();
        if (profileData) {
            currentUser = mapPlayerData(profileData);
            console.log('‚úÖ Profil charg√©:', currentUser.username);
        }

        // Cr√©er les l√©gendes
        allLegends = [];
        Object.values(LEGENDS_BY_DOMAIN).forEach(domain => {
            allLegends.push(...domain);
        });
        allLegends.push(...MOROCCAN_LEGENDS);
        allLegends.sort((a, b) => b.xp - a.xp);

        await loadLeaderboardTab('global');
    }

    async function loadLeaderboardTab(tabType) {
        currentTab = tabType;
        currentPage = 1;

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.tab === tabType) {
                btn.classList.add('active');
            }
        });

        if (tabType === 'legends') {
            document.getElementById('table-title').textContent = 'Classement Universel (Joueurs + L√©gendes)';

            // Charger les joueurs
            const leaderboardData = await getLeaderboardData('global');
            if (leaderboardData && leaderboardData.length > 0) {
                allPlayers = leaderboardData.map(p => mapPlayerData(p));
            } else {
                allPlayers = [];
            }

            // Fusionner joueurs et l√©gendes
            const combinedList = [];

            // Ajouter les joueurs
            allPlayers.forEach(player => {
                combinedList.push({
                    ...player,
                    isLegend: false
                });
            });

            // Ajouter les l√©gendes
            allLegends.forEach(legend => {
                const legendLevel = calculateLevelFromXp(legend.xp);
                const estimatedHP = estimateLegendHP(legendLevel);
                
                combinedList.push({
                    id: 'legend_' + legend.name,
                    username: legend.name,
                    total_xp: legend.xp,
                    level: legendLevel,
                    galaxy: getGalaxyByLevel(legendLevel),
                    hp: estimatedHP,
                    isLegend: true,
                    description: legend.description,
                    profile_image_url: legend.avatar,
                    isMoroccan: MOROCCAN_LEGENDS.some(m => m.name === legend.name)
                });
            });

            // Trier par XP (descendant)
            combinedList.sort((a, b) => {
                return b.total_xp - a.total_xp;
            });

            filteredPlayers = combinedList;
        } else {
            document.getElementById('table-title').textContent = 'Classement';
            console.log('üìä Chargement leaderboard ' + tabType + '...');
            const leaderboardData = await getLeaderboardData(tabType);

            if (leaderboardData && leaderboardData.length > 0) {
                allPlayers = leaderboardData.map(p => mapPlayerData(p));
                allPlayers.sort((a, b) => b.total_xp - a.total_xp);
                allPlayers.forEach((player, index) => {
                    player.rank = index + 1;
                });
                console.log('‚úÖ Joueurs charg√©s: ' + allPlayers.length);
            } else {
                allPlayers = [];
            }

            filteredPlayers = [...allPlayers];
        }

        applyCurrentSort();
        renderLeaderboard();
        renderYourRank();
        renderStats();
    }

    // ==================== API CALLS ====================

    async function getProfileData() {
        try {
            const response = await fetch('/api/get-user-data/', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                credentials: 'include'
            });

            if (!response.ok) throw new Error('Erreur API');

            const data = await response.json();
            
            // Calculer les HP depuis traitsHP
            let totalHP = 0;
            if (data.traitsHP && typeof data.traitsHP === 'object') {
                totalHP = Object.values(data.traitsHP).reduce((sum, hp) => sum + (parseInt(hp) || 0), 0);
            }
            
            return {
                user_id: data.user?.id || 1,
                username: data.user?.username || 'Utilisateur',
                level: calculateLevelFromXp(data.totalXP || 0),
                total_xp: data.totalXP || 0,
                traitsHP: data.traitsHP || {},
                hp: totalHP,
                id: data.user?.id || 1,
                profile_image_url: data.profile_image_url || null
            };
        } catch (error) {
            console.error('‚ùå Erreur profil:', error);
            return null;
        }
    }

    async function getLeaderboardData(type = 'global') {
        try {
            let endpoint = '/api/leaderboard/';
            if (type === 'weekly') {
                endpoint = '/api/leaderboard/weekly/';
            } else if (type === 'monthly') {
                endpoint = '/api/leaderboard/monthly/';
            }

            const response = await fetch(endpoint, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                credentials: 'include'
            });

            if (!response.ok) throw new Error('Erreur API leaderboard');

            const data = await response.json();
            console.log('‚úÖ API Response:', data);
            return Array.isArray(data) ? data : (data.data || []);
        } catch (error) {
            console.error('‚ùå Erreur leaderboard:', error);
            return [];
        }
    }

    // ==================== DATA MAPPING ====================

    // Fonction pour estimer les HP des l√©gendes bas√©s sur leur niveau
    function estimateLegendHP(level) {
        // Formule : HP estim√© = niveau * 250 (valeur moyenne progressive)
        // Les l√©gendes de haut niveau ont des HP √©lev√©s
        return Math.floor(level * 250);
    }

    function mapPlayerData(player) {
        const totalXp = player.experience_points || player.total_points || player.total_xp || 0;
        const level = calculateLevelFromXp(totalXp);
        const galaxy = getGalaxyByLevel(level);

        // Calculer les HP depuis traitsHP OU utiliser total_hp de l'API
        let totalHP = 0;
        
        // Priorit√© 1 : Utiliser total_hp si fourni par l'API backend
        if (player.total_hp !== undefined) {
            totalHP = parseInt(player.total_hp) || 0;
        }
        // Priorit√© 2 : Calculer depuis traitsHP si disponible
        else if (player.traitsHP && typeof player.traitsHP === 'object') {
            totalHP = Object.values(player.traitsHP).reduce((sum, hp) => sum + (parseInt(hp) || 0), 0);
        }
        // Priorit√© 3 : Estimer bas√© sur le niveau (temporaire)
        else {
            totalHP = estimateLegendHP(level);
            console.log(`‚ö†Ô∏è HP estim√©s pour ${player.username}: ${totalHP} (niveau ${level})`);
        }

        return {
            id: player.user_id || player.id || 0,
            username: player.username || 'Joueur',
            total_xp: totalXp,
            level: level,
            galaxy: galaxy,
            rank: player.rank || 0,
            hp: totalHP,
            isLegend: false,
            profile_image_url: player.profile_image_url || null,
            traitsHP: player.traitsHP || {}
        };
    }

    // ==================== GENERATE AVATAR FALLBACK ====================

    function getAvatarUrl(player) {
        if (player.profile_image_url) {
            return player.profile_image_url;
        }
        // G√©n√®re un avatar avec UI Avatars
        return `https://ui-avatars.com/api/?name=${encodeURIComponent(player.username)}&background=random&color=fff&size=128`;
    }

    // ==================== RENDER YOUR RANK ====================

    function renderYourRank() {
        if (!currentUser) {
            document.getElementById('your-rank-username').textContent = 'Non connect√©';
            document.getElementById('your-rank-position').textContent = '-';
            return;
        }

        if (currentTab === 'legends') {
            document.getElementById('your-rank-card').style.display = 'block';
            const yourRank = filteredPlayers.findIndex(p => !p.isLegend && p.id === currentUser.id) + 1;
            if (yourRank > 0) {
                document.getElementById('your-rank-position').textContent = yourRank;
            } else {
                document.getElementById('your-rank-position').textContent = '-';
            }
        } else {
            document.getElementById('your-rank-card').style.display = 'block';
            const yourRank = allPlayers.findIndex(p => p.id === currentUser.id) + 1 || allPlayers.length + 1;
            document.getElementById('your-rank-position').textContent = yourRank;
        }

        const galaxy = currentUser.galaxy;

        document.getElementById('your-rank-username').textContent = currentUser.username;
        document.getElementById('your-rank-xp').textContent = Math.floor(currentUser.total_xp).toLocaleString('fr-FR');
        document.getElementById('your-rank-hp').textContent = Math.floor(currentUser.hp || 0).toLocaleString('fr-FR');
        document.getElementById('your-rank-level').textContent = currentUser.level;

        const galaxyElement = document.getElementById('your-rank-galaxy');
        if (galaxyElement) {
            galaxyElement.textContent = galaxy.name;
            galaxyElement.style.color = galaxy.color;
        }

        const progress = getProgressToNextLevel(currentUser.level, currentUser.total_xp);
        document.getElementById('your-rank-progress').style.width = progress + '%';
        document.getElementById('your-rank-percentage').textContent = Math.floor(progress) + '%';
    }

    // ==================== RENDER LEADERBOARD WITH PHOTOS ====================

    function renderLeaderboard() {
        const start = (currentPage - 1) * ROWS_PER_PAGE;
        const end = start + ROWS_PER_PAGE;

        let pageData = filteredPlayers.slice(start, end);
        const tbody = document.getElementById('leaderboard-tbody');

        if (filteredPlayers.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">Aucun joueur au classement pour le moment</td></tr>';
            return;
        }

        tbody.innerHTML = pageData.map((player, idx) => {
            const rankNumber = start + idx + 1;
            const isYourRow = currentUser && !player.isLegend && player.id === currentUser.id;
            const isLegend = player.isLegend;

            // ‚úÖ UTILISER LA PHOTO DU JOUEUR
            const photoUrl = getAvatarUrl(player);

            return `
                <tr ${isYourRow ? 'class="your-row"' : (isLegend ? 'class="legend-row"' : '')}>
                    <td class="rank-col">
                        <div class="rank-number ${isLegend ? 'legend' : ''}">
                            ${rankNumber}
                        </div>
                    </td>
                    <td class="player-col">
                        <div class="player-info">
                            <div class="player-avatar-mini ${isLegend ? 'legend' : ''}">
                                <img src="${photoUrl}" alt="${player.username}" class="player-avatar-img" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(player.username)}&background=random&color=fff&size=128'">
                            </div>
                            <div class="player-details">
                                <div class="player-username">${player.username}</div>
                                <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                    ${isYourRow ? '<div class="player-badge">Vous</div>' : ''}
                                    ${isLegend ? '<div class="player-badge legend">L√©gende</div>' : ''}
                                    ${player.isMoroccan ? '<div class="player-badge moroccan">üá≤üá¶ MAR</div>' : ''}
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="level-col">
                        <div class="level-badge">Lvl ${player.level}</div>
                    </td>
                    <td class="galaxy-col">
                        <div class="galaxy-badge" style="color: ${player.galaxy.color};">
                            ${player.galaxy.name}
                        </div>
                    </td>
                    <td class="xp-col">
                        <div class="xp-value">${Math.floor(player.total_xp).toLocaleString('fr-FR')}</div>
                    </td>
                    <td class="hp-col">
                        <div class="hp-value">${Math.floor(player.hp || 0).toLocaleString('fr-FR')}</div>
                    </td>
                    <td class="action-col">
                        <button class="btn-view-profile ${isLegend ? 'legend' : ''}" onclick="openProfileModal('${player.username.replace(/'/g, "\\'")}', ${player.level}, ${Math.floor(player.total_xp)}, '${player.galaxy.name}', '${(player.description || '').replace(/'/g, "\\'").replace(/\n/g, ' ')}', ${Math.floor(player.hp || 0)})" style="white-space: nowrap;">
                            Voir
                        </button>
                    </td>
                </tr>
            `;
        }).join('');

        const totalPages = Math.ceil(filteredPlayers.length / ROWS_PER_PAGE);
        document.getElementById('current-page').textContent = currentPage;
        document.getElementById('total-pages').textContent = totalPages;
        document.getElementById('prev-page').disabled = currentPage === 1;
        document.getElementById('next-page').disabled = currentPage === totalPages;

        console.log(`‚úÖ ${pageData.length} joueurs rendus (page ${currentPage}/${totalPages})`);
    }

    // ==================== RENDER STATS ====================

    function renderStats() {
        if (filteredPlayers.length === 0) {
            document.getElementById('total-players').textContent = '0';
            document.getElementById('avg-xp').textContent = '0';
            document.getElementById('avg-hp').textContent = '0';
            document.getElementById('avg-level').textContent = 'Lvl 0';
            document.getElementById('avg-galaxy').textContent = 'N/A';
            return;
        }

        const totalPlayers = filteredPlayers.length;
        const avgXp = Math.floor(filteredPlayers.reduce((sum, p) => sum + p.total_xp, 0) / totalPlayers);
        const avgHp = Math.floor(filteredPlayers.reduce((sum, p) => sum + (p.hp || 0), 0) / totalPlayers);
        const avgLevel = Math.floor(filteredPlayers.reduce((sum, p) => sum + p.level, 0) / totalPlayers);
        const topGalaxy = getGalaxyByLevel(avgLevel);

        document.getElementById('total-players').textContent = totalPlayers.toLocaleString('fr-FR');
        document.getElementById('avg-xp').textContent = avgXp.toLocaleString('fr-FR');
        document.getElementById('avg-hp').textContent = avgHp.toLocaleString('fr-FR');
        document.getElementById('avg-level').textContent = 'Lvl ' + avgLevel;

        const galaxyElement = document.getElementById('avg-galaxy');
        if (galaxyElement) {
            galaxyElement.textContent = topGalaxy.name;
            galaxyElement.style.color = topGalaxy.color;
        }
    }

    // ==================== MODAL ====================

    function openProfileModal(username, level, xp, galaxyName, description, hp = 0) {
        const modal = document.getElementById('profile-modal-overlay');
        const galaxy = getGalaxyByLevel(level);

        document.getElementById('modal-username').textContent = username;
        document.getElementById('modal-level').textContent = 'Lvl ' + level;
        document.getElementById('modal-xp').textContent = xp.toLocaleString('fr-FR');
        document.getElementById('modal-hp').textContent = hp.toLocaleString('fr-FR');
        document.getElementById('modal-galaxy').textContent = galaxy.name;
        document.getElementById('modal-galaxy').style.color = galaxy.color;

        const descElement = document.getElementById('modal-description');

        if (description && description.trim()) {
            descElement.textContent = description;
        } else {
            descElement.textContent = 'Aucune description disponible';
        }

        modal.classList.add('active');
    }

    function closeProfileModal() {
        const modal = document.getElementById('profile-modal-overlay');
        modal.classList.remove('active');
    }

    // ==================== EVENT LISTENERS ====================

    document.getElementById('prev-page')?.addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            renderLeaderboard();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    });

    document.getElementById('next-page')?.addEventListener('click', () => {
        const totalPages = Math.ceil(filteredPlayers.length / ROWS_PER_PAGE);
        if (currentPage < totalPages) {
            currentPage++;
            renderLeaderboard();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    });

    document.getElementById('search-input')?.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();

        if (currentTab === 'legends') {
            filteredPlayers = allLegends.filter(p => p.username.toLowerCase().includes(query));
        } else {
            filteredPlayers = allPlayers.filter(p => p.username.toLowerCase().includes(query));
        }
        
        applyCurrentSort();
        currentPage = 1;
        renderLeaderboard();
    });

    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const tabType = this.dataset.tab || 'global';
            loadLeaderboardTab(tabType);
        });
    });

    // Event listeners pour les boutons de tri
    document.querySelectorAll('.sort-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const sortType = this.dataset.sort;
            changeSortType(sortType);
        });
    });

    document.getElementById('profile-modal-overlay')?.addEventListener('click', (e) => {
        if (e.target.id === 'profile-modal-overlay') {
            closeProfileModal();
        }
    });

    // ==================== INITIALIZATION ====================

    document.addEventListener('DOMContentLoaded', initializeLeaderboard);

    // ==================== AUTO-REFRESH ====================

    setInterval(() => {
        console.log('üîÑ Actualisation du leaderboard...');
        if (currentTab !== 'legends') {
            loadLeaderboardTab(currentTab);
        }
    }, 30000);

</script>


{% endblock %}
